# DDD ê¸°ë°˜ ì£¼ë¬¸-ê²°ì œ ë„ë©”ì¸ ì„¤ê³„

## ğŸ“‹ ëª©ì°¨
1. [ë„ë©”ì¸ ì´í•´](#ë„ë©”ì¸-ì´í•´)
2. [ìœ ë¹„ì¿¼í„°ìŠ¤ ì–¸ì–´](#ìœ ë¹„ì¿¼í„°ìŠ¤-ì–¸ì–´)
3. [ë°”ìš´ë””ë“œ ì»¨í…ìŠ¤íŠ¸](#ë°”ìš´ë””ë“œ-ì»¨í…ìŠ¤íŠ¸)
4. [ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„](#ë„ë©”ì¸-ëª¨ë¸-ì„¤ê³„)
5. [ì• ê·¸ë¦¬ê±°íŠ¸ ì„¤ê³„](#ì• ê·¸ë¦¬ê±°íŠ¸-ì„¤ê³„)
6. [ë„ë©”ì¸ ì´ë²¤íŠ¸](#ë„ë©”ì¸-ì´ë²¤íŠ¸)
7. [ì•„í‚¤í…ì²˜ ë ˆì´ì–´](#ì•„í‚¤í…ì²˜-ë ˆì´ì–´)

---

## ğŸ¯ ë„ë©”ì¸ ì´í•´

### ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œë‚˜ë¦¬ì˜¤

**ë¬´ì‹ ì‚¬ ì‡¼í•‘ëª°ì˜ ì£¼ë¬¸-ê²°ì œ í”„ë¡œì„¸ìŠ¤:**

```
1. ì‚¬ìš©ìê°€ ì¥ë°”êµ¬ë‹ˆì—ì„œ ìƒí’ˆ ì„ íƒ
2. ì£¼ë¬¸ ìƒì„± (ì—¬ëŸ¬ ìƒí’ˆ + ì˜µì…˜)
   - ì¿ í° ì ìš© ê°€ëŠ¥
   - í• ì¸ ê¸ˆì•¡ ê³„ì‚°
3. ê²°ì œ ì§„í–‰
   - ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ
   - PGì‚¬ ì—°ë™
4. ê²°ì œ ì™„ë£Œ
   - ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
   - ì¬ê³  ì°¨ê°
5. ì •ì‚°
   - ë¸Œëœë“œë³„ ì •ì‚°
```

### í•µì‹¬ ë„ë©”ì¸ ê·œì¹™

1. **ì£¼ë¬¸ ìƒì„± ê·œì¹™**
   - í•˜ë‚˜ì˜ ì£¼ë¬¸ì€ ì—¬ëŸ¬ ìƒí’ˆì„ í¬í•¨í•  ìˆ˜ ìˆë‹¤
   - ê° ìƒí’ˆì€ íŠ¹ì • ì˜µì…˜ì„ ê°€ì ¸ì•¼ í•œë‹¤
   - ì¿ í°ì€ ì£¼ë¬¸ ë‹¨ìœ„ë¡œ ì ìš©ëœë‹¤
   - ì´ ì£¼ë¬¸ ê¸ˆì•¡ = Î£(ìƒí’ˆ ê°€ê²© Ã— ìˆ˜ëŸ‰) - í• ì¸ ê¸ˆì•¡

2. **ê²°ì œ ê·œì¹™**
   - í•˜ë‚˜ì˜ ì£¼ë¬¸ì€ í•˜ë‚˜ì˜ ê²°ì œë¥¼ ê°€ì§„ë‹¤
   - ê²°ì œëŠ” ìŠ¹ì¸/ì·¨ì†Œ/ì‹¤íŒ¨ ìƒíƒœë¥¼ ê°€ì§„ë‹¤
   - ê²°ì œ ì·¨ì†Œ ì‹œ ë¶€ë¶„ ì·¨ì†Œ ê°€ëŠ¥
   - ê²°ì œ ë‚´ì—­ì€ ëª¨ë‘ ë¡œê·¸ë¡œ ë‚¨ê¸´ë‹¤

3. **ì •ì‚° ê·œì¹™**
   - ê²°ì œ ì™„ë£Œ í›„ ì •ì‚° ê°€ëŠ¥ ìƒíƒœë¡œ ë³€ê²½
   - ë¸Œëœë“œë³„ë¡œ ì •ì‚° ê¸ˆì•¡ ê³„ì‚°
   - ì •ì‚° ì™„ë£Œ í›„ ë³€ê²½ ë¶ˆê°€

---

## ğŸ’¬ ìœ ë¹„ì¿¼í„°ìŠ¤ ì–¸ì–´ (Ubiquitous Language)

### ì£¼ë¬¸ ë„ë©”ì¸ ìš©ì–´

| ìš©ì–´ | ì˜ë¬¸ | ì„¤ëª… |
|------|------|------|
| **ì£¼ë¬¸** | Order | ê³ ê°ì´ ìƒí’ˆì„ êµ¬ë§¤í•˜ê¸° ìœ„í•œ ìš”ì²­ |
| **ì£¼ë¬¸ë²ˆí˜¸** | OrderNo | ì™¸ë¶€ì— ë…¸ì¶œë˜ëŠ” ì£¼ë¬¸ ì‹ë³„ì |
| **ì£¼ë¬¸ì** | Orderer | ì£¼ë¬¸ì„ ìƒì„±í•œ ì‚¬ìš©ì |
| **ì£¼ë¬¸ìƒí’ˆ** | OrderProduct | ì£¼ë¬¸ì— í¬í•¨ëœ ê°œë³„ ìƒí’ˆ ì •ë³´ |
| **ì£¼ë¬¸ê¸ˆì•¡** | OrderAmount | ì£¼ë¬¸ì˜ ê¸ˆì•¡ ì •ë³´ (ì´ì•¡, í• ì¸, ìµœì¢…) |
| **ì£¼ë¬¸ìƒíƒœ** | OrderStatus | ì£¼ë¬¸ì˜ í˜„ì¬ ìƒíƒœ (ìƒì„±, ê²°ì œì™„ë£Œ, ë°°ì†¡ì¤‘ ë“±) |

### ê²°ì œ ë„ë©”ì¸ ìš©ì–´

| ìš©ì–´ | ì˜ë¬¸ | ì„¤ëª… |
|------|------|------|
| **ê²°ì œ** | Payment | ì£¼ë¬¸ì— ëŒ€í•œ ê¸ˆì•¡ ì§€ë¶ˆ |
| **ê²°ì œìˆ˜ë‹¨** | PaymentMethod | ê²°ì œ ë°©ë²• (ì¹´ë“œ, ê³„ì¢Œì´ì²´ ë“±) |
| **ê²°ì œìƒíƒœ** | PaymentStatus | ê²°ì œì˜ í˜„ì¬ ìƒíƒœ (ëŒ€ê¸°, ìŠ¹ì¸, ì·¨ì†Œ ë“±) |
| **ê²°ì œê¸ˆì•¡** | PaymentAmount | ì‹¤ì œ ê²°ì œëœ ê¸ˆì•¡ |
| **PGê±°ë˜ID** | PgTransactionId | PGì‚¬ì—ì„œ ë¶€ì—¬í•œ ê±°ë˜ ì‹ë³„ì |
| **ê²°ì œë¡œê·¸** | PaymentLog | ê²°ì œ ê³¼ì •ì˜ ëª¨ë“  ì´ë²¤íŠ¸ ê¸°ë¡ |

### ì •ì‚° ë„ë©”ì¸ ìš©ì–´

| ìš©ì–´ | ì˜ë¬¸ | ì„¤ëª… |
|------|------|------|
| **ì •ì‚°** | Settlement | ë¸Œëœë“œì— ì§€ê¸‰í•  ê¸ˆì•¡ ê³„ì‚° |
| **ì •ì‚°ê°€ëŠ¥ì—¬ë¶€** | IsSettleable | ì •ì‚° ê°€ëŠ¥í•œ ìƒíƒœì¸ì§€ ì—¬ë¶€ |
| **ì •ì‚°ì¼ì‹œ** | SettledAt | ì‹¤ì œ ì •ì‚°ì´ ì™„ë£Œëœ ì‹œì  |

---

## ğŸ›ï¸ ë°”ìš´ë””ë“œ ì»¨í…ìŠ¤íŠ¸ (Bounded Context)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Order-Payment Context                    â”‚
â”‚                    (ì£¼ë¬¸-ê²°ì œ ì»¨í…ìŠ¤íŠ¸)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Order Aggregate â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚ Payment Aggregate â”‚          â”‚
â”‚  â”‚   (ì£¼ë¬¸ ì§‘í•©)      â”‚        â”‚  (ê²°ì œ ì§‘í•©)       â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                           â”‚                      â”‚
â”‚           â”‚                           â”‚                      â”‚
â”‚           â–¼                           â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  OrderProduct    â”‚        â”‚   PaymentLog     â”‚          â”‚
â”‚  â”‚   (ì£¼ë¬¸ìƒí’ˆ)       â”‚        â”‚   (ê²°ì œë¡œê·¸)      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚ ì°¸ì¡°                          â”‚ ì°¸ì¡°
         â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Context      â”‚          â”‚  Product Context  â”‚
â”‚  (íšŒì› ì»¨í…ìŠ¤íŠ¸)     â”‚          â”‚  (ìƒí’ˆ ì»¨í…ìŠ¤íŠ¸)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚ ì°¸ì¡°                          â”‚ ì°¸ì¡°
         â”‚                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Coupon Context    â”‚          â”‚  Brand Context    â”‚
â”‚  (ì¿ í° ì»¨í…ìŠ¤íŠ¸)     â”‚          â”‚  (ë¸Œëœë“œ ì»¨í…ìŠ¤íŠ¸)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»¨í…ìŠ¤íŠ¸ ê´€ê³„

- **Order-Payment**: ê°•í•œ ì¼ê´€ì„± (ë™ì¼ íŠ¸ëœì­ì…˜)
- **Order â†” User**: ì•½í•œ ì°¸ì¡° (IDë§Œ ë³´ìœ )
- **Order â†” Product**: ì•½í•œ ì°¸ì¡° (IDë§Œ ë³´ìœ )
- **Order â†” Coupon**: ì•½í•œ ì°¸ì¡° (IDë§Œ ë³´ìœ )
- **Order â†” Brand**: ì•½í•œ ì°¸ì¡° (IDë§Œ ë³´ìœ )

---

## ğŸ¨ ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„

### 1. Order Aggregate (ì£¼ë¬¸ ì• ê·¸ë¦¬ê±°íŠ¸)

```java
/**
 * ì£¼ë¬¸ ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸
 * - ì£¼ë¬¸ ìƒì„±, ì·¨ì†Œ, ìƒíƒœ ë³€ê²½
 * - ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚°
 * - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
 */
@Entity
@Table(name = "`Order`")
@Getter
public class Order extends BaseEntity {
    
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long orderId;
    
    // Value Object: ì£¼ë¬¸ì ì •ë³´
    @Embedded
    private Orderer orderer;
    
    // Value Object: ì£¼ë¬¸ ê¸ˆì•¡
    @Embedded
    private OrderAmount orderAmount;
    
    // Value Object: ì£¼ë¬¸ ìƒíƒœ
    @Embedded
    private OrderStatus orderStatus;
    
    // ì™¸ë¶€ ë…¸ì¶œìš© ì£¼ë¬¸ë²ˆí˜¸ (Value Object)
    @Embedded
    private OrderNo orderNo;
    
    // ì¿ í° (ì•½í•œ ì°¸ì¡°)
    private Long couponId;
    
    // ë¸Œëœë“œ (ì•½í•œ ì°¸ì¡°)
    private Long brandId;
    
    // ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ (Entity)
    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<OrderProduct> orderProducts = new ArrayList<>();
    
    // ì •ì‚° ì •ë³´
    private boolean isSettleable;
    private LocalDateTime settledAt;
    
    // ìƒì„±ì (íŒ©í† ë¦¬ ë©”ì„œë“œ)
    protected Order() {}
    
    /**
     * ì£¼ë¬¸ ìƒì„± (ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ)
     */
    public static Order create(
        Orderer orderer,
        List<OrderProductCommand> productCommands,
        Long couponId,
        Long brandId
    ) {
        Order order = new Order();
        order.orderer = orderer;
        order.couponId = couponId;
        order.brandId = brandId;
        order.orderNo = OrderNo.generate();
        order.orderStatus = OrderStatus.CREATED;
        
        // ì£¼ë¬¸ ìƒí’ˆ ì¶”ê°€
        productCommands.forEach(cmd -> 
            order.addOrderProduct(cmd.toOrderProduct())
        );
        
        // ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚°
        order.calculateAmount();
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        order.registerEvent(new OrderCreatedEvent(order));
        
        return order;
    }
    
    /**
     * ì£¼ë¬¸ ìƒí’ˆ ì¶”ê°€
     */
    private void addOrderProduct(OrderProduct orderProduct) {
        this.orderProducts.add(orderProduct);
        orderProduct.assignOrder(this);
    }
    
    /**
     * ì£¼ë¬¸ ê¸ˆì•¡ ê³„ì‚° (í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
     */
    private void calculateAmount() {
        BigDecimal totalPrice = orderProducts.stream()
            .map(OrderProduct::calculatePrice)
            .reduce(BigDecimal.ZERO, BigDecimal::add);
        
        BigDecimal discount = calculateDiscount(totalPrice);
        BigDecimal finalAmount = totalPrice.subtract(discount);
        
        this.orderAmount = new OrderAmount(totalPrice, discount, finalAmount);
    }
    
    /**
     * í• ì¸ ê¸ˆì•¡ ê³„ì‚° (ì¿ í° ì ìš©)
     */
    private BigDecimal calculateDiscount(BigDecimal totalPrice) {
        // TODO: ì¿ í° ì„œë¹„ìŠ¤ í˜¸ì¶œí•˜ì—¬ í• ì¸ ê¸ˆì•¡ ê³„ì‚°
        return BigDecimal.ZERO;
    }
    
    /**
     * ê²°ì œ ì™„ë£Œ ì²˜ë¦¬
     */
    public void completePayment() {
        validateCanCompletePayment();
        
        this.orderStatus = OrderStatus.PAYMENT_COMPLETED;
        this.isSettleable = true;
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        this.registerEvent(new OrderPaymentCompletedEvent(this));
    }
    
    /**
     * ì£¼ë¬¸ ì·¨ì†Œ
     */
    public void cancel(String reason) {
        validateCanCancel();
        
        this.orderStatus = OrderStatus.CANCELLED;
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        this.registerEvent(new OrderCancelledEvent(this, reason));
    }
    
    /**
     * ì •ì‚° ì™„ë£Œ ì²˜ë¦¬
     */
    public void completeSettlement() {
        if (!this.isSettleable) {
            throw new IllegalStateException("ì •ì‚° ê°€ëŠ¥í•œ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
        }
        
        this.settledAt = LocalDateTime.now();
        this.isSettleable = false;
    }
    
    // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
    private void validateCanCompletePayment() {
        if (this.orderStatus != OrderStatus.CREATED) {
            throw new IllegalStateException("ê²°ì œ ì™„ë£Œ ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤.");
        }
    }
    
    private void validateCanCancel() {
        if (this.orderStatus == OrderStatus.CANCELLED) {
            throw new IllegalStateException("ì´ë¯¸ ì·¨ì†Œëœ ì£¼ë¬¸ì…ë‹ˆë‹¤.");
        }
        if (this.orderStatus == OrderStatus.DELIVERED) {
            throw new IllegalStateException("ë°°ì†¡ ì™„ë£Œëœ ì£¼ë¬¸ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }
}
```

### 2. OrderProduct Entity (ì£¼ë¬¸ìƒí’ˆ)

```java
/**
 * ì£¼ë¬¸ ìƒí’ˆ ì—”í‹°í‹°
 * - Orderì˜ í•˜ìœ„ ì—”í‹°í‹°
 * - ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•  ìˆ˜ ì—†ìŒ (Orderì™€ ìƒëª…ì£¼ê¸° í•¨ê»˜)
 */
@Entity
@Getter
public class OrderProduct extends BaseEntity {
    
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long orderProductId;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "order_id")
    private Order order;
    
    // ì£¼ë¬¸ì (Orderì™€ ë™ì¼, ë¹„ì •ê·œí™”)
    private Long userId;
    
    // ìƒí’ˆ ì •ë³´ (ì•½í•œ ì°¸ì¡°)
    private Long productId;
    private Long productOptionId;
    
    // ê°€ê²© ìŠ¤ëƒ…ìƒ· (ì£¼ë¬¸ ë‹¹ì‹œ ê°€ê²©)
    @Embedded
    private Money productPrice;
    
    // ìˆ˜ëŸ‰
    private int productQuantity;
    
    // ì´ë²¤íŠ¸ ì •ë³´
    private Long eventId;
    
    // ê²°ì œ ì™„ë£Œ ì—¬ë¶€
    private boolean paidFlag;
    
    // ì¬ê³  ì°¨ê° ë²”ìœ„
    @Enumerated(EnumType.STRING)
    private LimitScope limitScope;
    
    protected OrderProduct() {}
    
    /**
     * ì£¼ë¬¸ ìƒí’ˆ ìƒì„±
     */
    public static OrderProduct create(
        Long userId,
        Long productId,
        Long productOptionId,
        Money productPrice,
        int quantity,
        Long eventId
    ) {
        OrderProduct orderProduct = new OrderProduct();
        orderProduct.userId = userId;
        orderProduct.productId = productId;
        orderProduct.productOptionId = productOptionId;
        orderProduct.productPrice = productPrice;
        orderProduct.productQuantity = quantity;
        orderProduct.eventId = eventId;
        orderProduct.paidFlag = false;
        
        // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
        orderProduct.validate();
        
        return orderProduct;
    }
    
    /**
     * ì£¼ë¬¸ í• ë‹¹
     */
    void assignOrder(Order order) {
        this.order = order;
    }
    
    /**
     * ê°€ê²© ê³„ì‚°
     */
    public BigDecimal calculatePrice() {
        return productPrice.multiply(productQuantity);
    }
    
    /**
     * ê²°ì œ ì™„ë£Œ ì²˜ë¦¬
     */
    public void completePaid() {
        this.paidFlag = true;
    }
    
    /**
     * ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
     */
    private void validate() {
        if (productQuantity <= 0) {
            throw new IllegalArgumentException("ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.");
        }
        if (productPrice.isNegative()) {
            throw new IllegalArgumentException("ê°€ê²©ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }
}
```

### 3. Payment Aggregate (ê²°ì œ ì• ê·¸ë¦¬ê±°íŠ¸)

```java
/**
 * ê²°ì œ ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸
 * - ê²°ì œ ìŠ¹ì¸, ì·¨ì†Œ
 * - PGì‚¬ ì—°ë™
 * - ê²°ì œ ì´ë ¥ ê´€ë¦¬
 */
@Entity
@Getter
public class Payment extends BaseEntity {
    
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long paymentId;
    
    // ê²°ì œ ìˆ˜ë‹¨
    private Integer paymentMethodId;
    
    // ê²°ì œ ìƒíƒœ
    @Embedded
    private PaymentStatus paymentStatus;
    
    // ì£¼ë¬¸ (ì•½í•œ ì°¸ì¡°)
    private Long orderId;
    
    // ê²°ì œ ê¸ˆì•¡ ì •ë³´
    @Embedded
    private PaymentAmount paymentAmount;
    
    // PGì‚¬ ì •ë³´
    @Embedded
    private PgInfo pgInfo;
    
    // ì·¨ì†Œ ì •ë³´
    private LocalDateTime cancelledAt;
    private LocalDateTime approvedAt;
    
    // ê²°ì œ ë¡œê·¸ (Entity)
    @OneToMany(mappedBy = "payment", cascade = CascadeType.ALL)
    private List<PaymentLog> paymentLogs = new ArrayList<>();
    
    protected Payment() {}
    
    /**
     * ê²°ì œ ìƒì„± (ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ)
     */
    public static Payment create(
        Long orderId,
        Integer paymentMethodId,
        Money amount,
        String pgProvider
    ) {
        Payment payment = new Payment();
        payment.orderId = orderId;
        payment.paymentMethodId = paymentMethodId;
        payment.paymentAmount = new PaymentAmount(amount);
        payment.pgInfo = PgInfo.create(pgProvider);
        payment.paymentStatus = PaymentStatus.PENDING;
        
        // ê²°ì œ ë¡œê·¸ ì¶”ê°€
        payment.addLog(PaymentEventType.CREATED, "ê²°ì œ ìƒì„±");
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        payment.registerEvent(new PaymentCreatedEvent(payment));
        
        return payment;
    }
    
    /**
     * ê²°ì œ ìŠ¹ì¸
     */
    public void approve(String pgTransactionId) {
        validateCanApprove();
        
        this.pgInfo = pgInfo.withTransactionId(pgTransactionId);
        this.paymentStatus = PaymentStatus.APPROVED;
        this.approvedAt = LocalDateTime.now();
        
        // ê²°ì œ ë¡œê·¸ ì¶”ê°€
        this.addLog(PaymentEventType.APPROVED, "ê²°ì œ ìŠ¹ì¸ ì™„ë£Œ");
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        this.registerEvent(new PaymentApprovedEvent(this));
    }
    
    /**
     * ê²°ì œ ì·¨ì†Œ
     */
    public void cancel(String reason) {
        validateCanCancel();
        
        this.paymentStatus = PaymentStatus.CANCELLED;
        this.cancelledAt = LocalDateTime.now();
        
        // ê²°ì œ ë¡œê·¸ ì¶”ê°€
        this.addLog(PaymentEventType.CANCELLED, "ê²°ì œ ì·¨ì†Œ: " + reason);
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        this.registerEvent(new PaymentCancelledEvent(this, reason));
    }
    
    /**
     * ê²°ì œ ì‹¤íŒ¨
     */
    public void fail(String reason) {
        this.paymentStatus = PaymentStatus.FAILED;
        
        // ê²°ì œ ë¡œê·¸ ì¶”ê°€
        this.addLog(PaymentEventType.FAILED, "ê²°ì œ ì‹¤íŒ¨: " + reason);
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        this.registerEvent(new PaymentFailedEvent(this, reason));
    }
    
    /**
     * ê²°ì œ ë¡œê·¸ ì¶”ê°€
     */
    private void addLog(PaymentEventType eventType, String description) {
        PaymentLog log = PaymentLog.create(this, eventType, description);
        this.paymentLogs.add(log);
    }
    
    // ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
    private void validateCanApprove() {
        if (this.paymentStatus != PaymentStatus.PENDING) {
            throw new IllegalStateException("ìŠ¹ì¸í•  ìˆ˜ ì—†ëŠ” ê²°ì œ ìƒíƒœì…ë‹ˆë‹¤.");
        }
    }
    
    private void validateCanCancel() {
        if (this.paymentStatus == PaymentStatus.CANCELLED) {
            throw new IllegalStateException("ì´ë¯¸ ì·¨ì†Œëœ ê²°ì œì…ë‹ˆë‹¤.");
        }
        if (this.paymentStatus != PaymentStatus.APPROVED) {
            throw new IllegalStateException("ìŠ¹ì¸ëœ ê²°ì œë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }
    }
}
```

### 4. PaymentLog Entity (ê²°ì œë¡œê·¸)

```java
/**
 * ê²°ì œ ë¡œê·¸ ì—”í‹°í‹°
 * - Paymentì˜ í•˜ìœ„ ì—”í‹°í‹°
 * - ê²°ì œ ê³¼ì •ì˜ ëª¨ë“  ì´ë²¤íŠ¸ ê¸°ë¡
 * - Immutable (ë³€ê²½ ë¶ˆê°€)
 */
@Entity
@Getter
public class PaymentLog extends BaseEntity {
    
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long paymentHistoryId;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "payment_id")
    private Payment payment;
    
    private Long userId;
    
    @Enumerated(EnumType.STRING)
    private PaymentEventType eventStatus;
    
    private String description;
    
    protected PaymentLog() {}
    
    /**
     * ê²°ì œ ë¡œê·¸ ìƒì„±
     */
    public static PaymentLog create(
        Payment payment,
        PaymentEventType eventType,
        String description
    ) {
        PaymentLog log = new PaymentLog();
        log.payment = payment;
        log.userId = extractUserIdFromPayment(payment);
        log.eventStatus = eventType;
        log.description = description;
        
        return log;
    }
    
    private static Long extractUserIdFromPayment(Payment payment) {
        // TODO: Order ì¡°íšŒí•˜ì—¬ userId ì¶”ì¶œ
        return null;
    }
}
```

---

## ğŸ§© Value Object ì„¤ê³„

### 1. Orderer (ì£¼ë¬¸ì)

```java
@Embeddable
@Getter
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Orderer {
    
    @Column(name = "user_id")
    private Integer userId;
    
    public Orderer(Integer userId) {
        validateUserId(userId);
        this.userId = userId;
    }
    
    private void validateUserId(Integer userId) {
        if (userId == null || userId <= 0) {
            throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì IDì…ë‹ˆë‹¤.");
        }
    }
}
```

### 2. OrderAmount (ì£¼ë¬¸ê¸ˆì•¡)

```java
@Embeddable
@Getter
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class OrderAmount {
    
    @Column(name = "total_price")
    private BigDecimal totalPrice;
    
    @Column(name = "total_discount")
    private BigDecimal totalDiscount;
    
    @Column(name = "final_payment_amount")
    private BigDecimal finalPaymentAmount;
    
    public OrderAmount(
        BigDecimal totalPrice,
        BigDecimal totalDiscount,
        BigDecimal finalPaymentAmount
    ) {
        validateAmounts(totalPrice, totalDiscount, finalPaymentAmount);
        
        this.totalPrice = totalPrice;
        this.totalDiscount = totalDiscount;
        this.finalPaymentAmount = finalPaymentAmount;
    }
    
    private void validateAmounts(
        BigDecimal totalPrice,
        BigDecimal totalDiscount,
        BigDecimal finalPaymentAmount
    ) {
        if (totalPrice.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("ì´ ê¸ˆì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        if (totalDiscount.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("í• ì¸ ê¸ˆì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        if (finalPaymentAmount.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("ìµœì¢… ê¸ˆì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        if (!totalPrice.subtract(totalDiscount).equals(finalPaymentAmount)) {
            throw new IllegalArgumentException("ê¸ˆì•¡ ê³„ì‚°ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
    }
}
```

### 3. OrderNo (ì£¼ë¬¸ë²ˆí˜¸)

```java
@Embeddable
@Getter
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class OrderNo {
    
    @Column(name = "order_no", unique = true)
    private String value;
    
    private OrderNo(String value) {
        this.value = value;
    }
    
    /**
     * ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±
     * í˜•ì‹: ORD-{YYYYMMDD}-{6ìë¦¬ ëœë¤}
     */
    public static OrderNo generate() {
        String datePart = LocalDateTime.now()
            .format(DateTimeFormatter.ofPattern("yyyyMMdd"));
        String randomPart = generateRandomString(6);
        
        return new OrderNo("ORD-" + datePart + "-" + randomPart);
    }
    
    private static String generateRandomString(int length) {
        return RandomStringUtils.randomAlphanumeric(length).toUpperCase();
    }
}
```

### 4. Money (ê¸ˆì•¡)

```java
@Embeddable
@Getter
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class Money {
    
    private BigDecimal amount;
    
    public Money(BigDecimal amount) {
        validateAmount(amount);
        this.amount = amount;
    }
    
    public Money(long amount) {
        this(BigDecimal.valueOf(amount));
    }
    
    public static Money ZERO = new Money(BigDecimal.ZERO);
    
    public Money add(Money other) {
        return new Money(this.amount.add(other.amount));
    }
    
    public Money subtract(Money other) {
        return new Money(this.amount.subtract(other.amount));
    }
    
    public Money multiply(int multiplier) {
        return new Money(this.amount.multiply(BigDecimal.valueOf(multiplier)));
    }
    
    public boolean isNegative() {
        return this.amount.compareTo(BigDecimal.ZERO) < 0;
    }
    
    public BigDecimal multiply(int productQuantity) {
        return this.amount.multiply(BigDecimal.valueOf(productQuantity));
    }
    
    private void validateAmount(BigDecimal amount) {
        if (amount == null) {
            throw new IllegalArgumentException("ê¸ˆì•¡ì€ nullì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
        if (amount.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("ê¸ˆì•¡ì€ ìŒìˆ˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }
}
```

### 5. PaymentStatus (ê²°ì œìƒíƒœ)

```java
@Embeddable
@Getter
@EqualsAndHashCode
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class PaymentStatus {
    
    @Column(name = "payment_status")
    private Integer statusCodeId;
    
    // ìƒìˆ˜
    public static final PaymentStatus PENDING = new PaymentStatus(StatusCode.PAYMENT_PENDING);
    public static final PaymentStatus APPROVED = new PaymentStatus(StatusCode.PAYMENT_APPROVED);
    public static final PaymentStatus CANCELLED = new PaymentStatus(StatusCode.PAYMENT_CANCELLED);
    public static final PaymentStatus FAILED = new PaymentStatus(StatusCode.PAYMENT_FAILED);
    
    private PaymentStatus(StatusCode statusCode) {
        this.statusCodeId = statusCode.getId();
    }
    
    public boolean isPending() {
        return this.equals(PENDING);
    }
    
    public boolean isApproved() {
        return this.equals(APPROVED);
    }
    
    public boolean isCancelled() {
        return this.equals(CANCELLED);
    }
}
```

---

## ğŸ¬ ë„ë©”ì¸ ì´ë²¤íŠ¸

### ì£¼ë¬¸ ì´ë²¤íŠ¸

```java
// ì£¼ë¬¸ ìƒì„±
public class OrderCreatedEvent extends DomainEvent {
    private final Long orderId;
    private final Integer userId;
    private final BigDecimal totalAmount;
}

// ì£¼ë¬¸ ê²°ì œ ì™„ë£Œ
public class OrderPaymentCompletedEvent extends DomainEvent {
    private final Long orderId;
    private final LocalDateTime completedAt;
}

// ì£¼ë¬¸ ì·¨ì†Œ
public class OrderCancelledEvent extends DomainEvent {
    private final Long orderId;
    private final String reason;
}
```

### ê²°ì œ ì´ë²¤íŠ¸

```java
// ê²°ì œ ìƒì„±
public class PaymentCreatedEvent extends DomainEvent {
    private final Long paymentId;
    private final Long orderId;
}

// ê²°ì œ ìŠ¹ì¸
public class PaymentApprovedEvent extends DomainEvent {
    private final Long paymentId;
    private final String pgTransactionId;
}

// ê²°ì œ ì·¨ì†Œ
public class PaymentCancelledEvent extends DomainEvent {
    private final Long paymentId;
    private final String reason;
}
```

---

## ğŸ“ ì•„í‚¤í…ì²˜ ë ˆì´ì–´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Presentation Layer                 â”‚
â”‚   (Controller, DTO, Request/Response)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Application Layer                  â”‚
â”‚   (ApplicationService, UseCase, Facade) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Domain Layer                    â”‚
â”‚   (Entity, VO, DomainService, Event)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Infrastructure Layer                â”‚
â”‚   (Repository, JPA, MyBatis, External)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

ë‹¤ìŒ ë‹¨ê³„ë¡œ ì‹¤ì œ ì½”ë“œ êµ¬í˜„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ğŸš€
