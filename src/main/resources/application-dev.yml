spring:
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}

  batch:
    jdbc:
      initialize-schema: never
    job:
      enabled: false  # 성능 테스트를 위해 임시 비활성화 (테스트 후 true로 복원 필요)

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&rewriteBatchedStatements=true
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      # ============================================================
      # HikariCP Pool Size 계산 (공식 기반)
      # ============================================================
      # 공식: (CPU 코어 × 2) + Spindle Count
      # DB 서버: 8코어, SSD(Spindle=1)
      # 계산: (8 × 2) + 1 = 17개
      # ============================================================
      maximum-pool-size: 17
      minimum-idle: 8

  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect

  devtools:
    restart:
      enabled: true #원래 true
    livereload:
      enabled: true


logging:
  level:
    # p6spy SQL 로깅 끄기
    p6spy: off

    # Application 로깅
    com.mudosa.musinsa: debug

    # JPA/Hibernate 로깅 (최적화)
    org.hibernate.SQL: INFO  # SQL 쿼리 (끄기)
    org.hibernate.type.descriptor.sql.BasicBinder: INFO  # 바인딩 파라미터 (끄기)
    org.hibernate.type.descriptor.sql.BasicExtractor: INFO  # 결과 추출 (끄기)
    org.hibernate.engine.transaction.internal.TransactionImpl: INFO  # 트랜잭션 로그 (끄기)
    org.hibernate.stat: INFO  # Hibernate 통계 (끄기)
    org.hibernate.sql: INFO
    org.hibernate.orm.jdbc.internal.LogicalConnectionImpl: INFO

    # MyBatis 로깅 (도메인별)
    com.mudosa.musinsa.domain.order.mapper: debug
    com.mudosa.musinsa.domain.payment.mapper: debug
    com.mudosa.musinsa.domain.user.mapper: debug
    com.mudosa.musinsa.domain.product.mapper: debug
    com.mudosa.musinsa.domain.brand.mapper: debug
    com.mudosa.musinsa.domain.coupon.mapper: debug
    com.mudosa.musinsa.domain.event.mapper: debug
    com.mudosa.musinsa.settlement.domain.repository: info  # Settlement MyBatis SQL 로그 숨김

    # Spring Framework 로깅
    org.springframework.web: info
    org.springframework.security: info
    org.springframework.jdbc.core: info
    org.springframework.transaction: INFO
    org.springframework.orm.jpa: INFO
    org.springframework.web.client.RestTemplate: INFO

    # Spring Batch 로깅
    org.springframework.batch: debug  # 배치 상세 로그 출력
    com.mudosa.musinsa.batch: debug  # 배치 애플리케이션 로그

    # HikariCP 로깅
    com.zaxxer.hikari: info

    # Connection Pool 상태 모니터링
    com.zaxxer.hikari.pool.HikariPool: info
    com.zaxxer.hikari.pool.PoolBase: info

    # Client 로깅
    com.mudosa.musinsa.common.client: DEBUG

jwt:
  secret: ${JWT_SECRET}                       # .env의 JWT_SECRET
  expiration: ${JWT_ACCESS_EXPIRATION:1800000}
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}

tosspayments:
  secret-key: ${TOSS_SECRET_KEY:test_gsk_docs_OaPz8L5KdmQXkzRz3y47BMw6}
  client-key: ${TOSS_CLIENT_KEY:test_gck_docs_Ovk5rk1EwkEbP0W43n07xlzm}
  confirm_url: https://api.tosspayments.com/v1/payments/confirm
  base_cancel_url: https://api.tosspayments.com/v1/payments

springdoc:
  swagger-ui:
    enabled: true
    display-request-duration: true
    groups-order: DESC
    operationsSorter: method
    disable-swagger-default-url: false
  api-docs:
    enabled: true

management:
  endpoints:
    web:
      exposure:
        include: prometheus, health, info # 필요한 것만 나열하거나 "*"로 전체 노출
  tracing:
    enabled: false  # 로컬 개발 환경에서는 OpenTelemetry 비활성화

fcm:
  service-account-file: key/fdbdproject.json
  topic-name: fdbdMessage
  project-id: fdbdproject

settlement:
  batch:
    insert-mode: jdbc  # jpa | jpa-batch | mybatis | jdbc (Phase 3 테스트용)
    upsert-enabled: true  # true: UPSERT(ON DUPLICATE KEY UPDATE), false: 순수 INSERT
    creation:
      chunk-size: 2000  # [테스트용] MySQL 튜닝 효과 측정
      page-size: 1000
    scheduler:
      enabled: true
      creation:
        enabled: true
      minute:
        enabled: true  # 실시간 집계 활성화 (매 분마다 집계)


# 테스트 API 활성화 (개발 환경에서만)
test:
  api:
    enabled: true
