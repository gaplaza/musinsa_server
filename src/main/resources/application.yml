spring:
  profiles:
    active: dev  # test-50k: 서버 테스트용 | dev: 로컬 개발용
  # Redis 설정은 각 profile 파일에서 관리 (application-dev.yml, application-test-50k.yml)

  application:
    name: musinsa-server

  jpa:
    properties:
      hibernate:
        format_sql: true
        # JPA Batch INSERT 설정 (Phase 2 비교 테스트용)
        jdbc:
          batch_size: 500  # 500건씩 묶어서 INSERT (IDENTITY 전략에서는 무시됨)
          batch_versioned_data: true
        order_inserts: true  # INSERT 순서 정렬
        order_updates: true

  batch:
    jdbc:
      initialize-schema: never  # 스키마 자동 생성 비활성화 (수동으로 관리)
    job:
      enabled: false  # Job 자동 실행 방지

settlement:
  batch:
    enabled: true  # 기본값: 배치 Job 활성화
    insert-mode: ${SETTLEMENT_INSERT_MODE:jdbc}  # 환경변수로 제어 (기본값: jdbc)
    creation:
      chunk-size: 2000  # [테스트용] MySQL 튜닝 효과 측정
      page-size: 1000
    scheduler:
      enabled: false  # 기본값: 스케줄러 비활성화 (각 프로파일에서 설정)
      creation:
        enabled: false  # 정산 생성 스케줄러 (각 프로파일에서 설정)
      minute:
        enabled: false  # 정산 집계 스케줄러 (각 프로파일에서 설정)

mybatis:
  mapper-locations:
    - classpath:/mappers/settlement/**/*.xml
    - classpath:/mappers/batch/**/*.xml
  type-aliases-package: com.mudosa.musinsa.settlement.application.dto
  configuration:
    map-underscore-to-camel-case: true

springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
    disable-swagger-default-url: true
    display-request-duration: true
    doc-expansion: none
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  show-actuator: false

logging:
  level:
    org.hibernate.sql: INFO
    org.springframework.orm.jpa.JpaTransactionManager: INFO
    org.springframework.transaction: INFO
    com.mudosa.musinsa.event.service.EventStatusService: INFO
    com.mudosa.musinsa.batch: INFO  # Batch 로그 INFO로 설정 (성능 측정 로그만 출력)
    com.mudosa.musinsa.settlement: INFO  # Settlement 로그 INFO로 설정
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %clr(%-5level) %clr(%logger{36}){cyan} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

jwt:
  secret: ${JWT_SECRET:this-is-a-very-long-default-secret-key-for-dev}
  expiration: ${JWT_ACCESS_EXPIRATION:86400000}    # 24시간 (개발용 기본값)
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:2592000000}  # 30일 (개발용 기본값)

server:
  port: ${SERVER_PORT:8080}
  address: 0.0.0.0  # 외부 접속 허용 (로컬 맥북에서 k6 테스트 가능)

test:
  endpoints:
    enabled: ${TEST_ENDPOINTS_ENABLED:true}  # 테스트용 API 활성화 (프로덕션에서는 false)

management:
  endpoints:
    web:
      exposure:
        include: prometheus, health, info

  tracing:
    enabled: true
    sampling:
      probability: 1.0

  otlp:
    tracing:
      endpoint: http://172.16.24.17:4318/v1/traces